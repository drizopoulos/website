<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>JMbayes2</title>
    <meta charset="utf-8" />
    <meta name="author" content="Dimitris Rizopoulos" />
    <meta name="date" content="2021-02-17" />
    <script src="libs/header-attrs-2.6/header-attrs.js"></script>
    <link href="libs/tile-view-0.2.4/tile-view.css" rel="stylesheet" />
    <script src="libs/tile-view-0.2.4/tile-view.js"></script>
    <script src="libs/xaringanExtra_fit-screen-0.2.4/fit-screen.js"></script>
    <link rel="stylesheet" href="style.css" type="text/css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">

class: title-slide-custom
count: false



&lt;!-- &lt;h1&gt;JMbayes2&lt;/h1&gt; --&gt;
&lt;div style="font-size: 50pt; font-weight: 900; color: var(--nord4); margin-top: 60px;"&gt;
JMbayes2
&lt;/div&gt;

&lt;div style="font-size: 26pt; color: var(--nord9); font-weight: 300; margin-top:40px;"&gt;
Extended Joint Models under the Bayesian Approach
&lt;/div&gt;

&lt;div id = "author"&gt;
&lt;div style = "font-size: 32pt; font-weight: bolder; color: var(--nord4);"&gt;Dimitris Rizopoulos&lt;/div&gt;
&lt;div style = "color: var(--nord9);"&gt;Department of Biostatistics&lt;/div&gt;
&lt;/div&gt;

&lt;div id="contact"&gt;
&lt;a href="mailto:d.rizopoulos@erasmusmc.nl"&gt;&lt;i class="fas fa-envelope"&gt;&lt;/i&gt; d.rizopoulos@erasmusmc.nl&lt;/a&gt; &amp;emsp;
&lt;a href="https://twitter.com/drizopoulos"&gt;&lt;i class="fab fa-twitter"&gt;&lt;/i&gt; drizopoulos&lt;/a&gt; &amp;emsp;
&lt;a href="https://github.com/drizopoulos"&gt;&lt;i class="fab fa-github"&gt;&lt;/i&gt; drizopoulos&lt;/a&gt; &amp;emsp;
&lt;/div&gt;

---
layout: true

&lt;link href="https://unpkg.com/nord-highlightjs@0.1.0/dist/nord.css" rel="stylesheet" type="text/css" /&gt;
&lt;link href="fontawesome-free-5.14.0-web/css/all.css" rel="stylesheet"&gt;

&lt;div class="my-footer"&gt;&lt;span&gt;
&lt;a href="https://twitter.com/drizopoulos"&gt;&lt;i class="fab fa-twitter"&gt;&lt;/i&gt; drizopoulos&lt;/a&gt;
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
&lt;a href="https://github.com/drizopoulos"&gt;&lt;i class="fab fa-github"&gt;&lt;/i&gt; drizopoulos&lt;/a&gt; &amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
&lt;a href = "http://www.drizopoulos.com/"&gt;&lt;i class="fas fa-globe-americas"&gt;&lt;/i&gt; www.drizopoulos.com&lt;/a&gt;
&lt;/span&gt;&lt;/div&gt; 

---
class: center, middle, animated, fadeIn

# Joint Models:&lt;br&gt;Current Standard

---

## A Bit of History

&lt;p&gt; &lt;/p&gt;

--

&lt;div style = "width: 75%; padding: 1.15em 2em; background-color: var(--nord0); margin: auto; display: block;"&gt;
&lt;strong&gt;Joint models have been around for many years...&lt;/strong&gt;
&lt;/div&gt;

--

&lt;br&gt;

- Two parallel trajectories

.pull-left[
**Event Process**
&lt;div style = "width: 75%; padding: 1.15em 2em; background-color: var(--nord0); margin: auto; display: block;"&gt;
endogenous time-varying covariates
&lt;/div&gt;
]

.pull-right[
**Longitudinal Outcomes**
&lt;div style = "width: 75%; padding: 1.15em 2em; background-color: var(--nord0); margin: auto; display: block;"&gt;
non-random (MNAR) dropout
&lt;/div&gt;
]


---

## JMs and Extensions

&lt;div style = "width: 75%; padding: 1.15em 2em; background-color: var(--nord0); margin: auto; display: block;"&gt;
&lt;strong&gt;Basic assumption: &lt;font color = "red"&gt;Conditional Independence&lt;/font&gt;&lt;/strong&gt; &lt;br&gt; The random effects \(\color{var(--nord15)}{b}\) explain all interrelationships.
&lt;/div&gt;

.footnote[
[&lt;i class = "fas fa-book"&gt;&lt;/i&gt; Rizopoulos (2012)](https://www.crcpress.com/product/isbn/9781439872864)
]

--

&lt;br&gt;
* `\(\mathcal{Y}\)`: Longitudinal process
* `\(\mathcal{T}\)`: Event process

--

`\begin{align*}
p\{\mathcal{Y},\, \mathcal{T} \mid \color{var(--nord15)}{b}\} = 
p\{\mathcal{Y} \mid \color{var(--nord15)}{b}\} \; 
p\{\mathcal{T} \mid \color{var(--nord15)}{b}\}
\end{align*}`

---

## JMs and Extensions

&lt;br&gt;

.pull-left[
**Longitudinal Process**
- multiple outcomes
- continuous, discrete, left-censored
- flexible models (splines, etc.)
]

.pull-right[
**Event Process**
- competing risks
- multi-state processes
- recurrent events
- multivariate
]

---

## JMs and Extensions

**Conditional Independence:** .reference[[&lt;i class = "fas fa-book"&gt;&lt;/i&gt; Rizopoulos (2012)](https://www.crcpress.com/product/isbn/9781439872864)]

&lt;ul class="fa-ul"&gt;
  &lt;li&gt;&lt;span class="fa-li" style = "color:var(--nord14);"&gt;
      &lt;i class="far fa-smile"&gt;&lt;/i&gt;&lt;/span&gt;
      mathematically convenient&lt;/li&gt;
  &lt;li&gt;&lt;span class="fa-li" style = "color:var(--nord11);"&gt;
  &lt;i class="far fa-frown"&gt;&lt;/i&gt;&lt;/span&gt;
  computionally intensive&lt;/li&gt;
&lt;/ul&gt;

--

.pull-left[
**Maximum Likelihood:**
&lt;div style = "width: 75%; padding: 1.15em 2em; background-color: var(--nord0); margin: auto; display: block;"&gt;
requires high-dimensional numerical integration
&lt;/div&gt;
]

.pull-right[
**Bayesian:**
&lt;div style = "width: 75%; padding: 1.15em 2em; background-color: var(--nord0); margin: auto; display: block;"&gt;
requires sampling high-dimensional random effects
&lt;/div&gt;
]

---

## Theory vs Practice

As with many other statistical techniques,&lt;br&gt; 
&amp;nbsp;&amp;nbsp;&amp;nbsp;it took some years for JMs software to appear

--

&lt;br&gt;

&lt;div style = "width: 75%; padding: 1.15em 2em; background-color: var(--nord0); margin: auto; display: block;"&gt;
&lt;strong&gt;Nowadays, given the rise of the  &lt;font color = "red"&gt;R ecosystem&lt;/font&gt; a number of packages is available&lt;/strong&gt;
&lt;/div&gt;


---

## Available Software

.pull-left[
**Maximum Likelihood:**

&lt;button class="modal-button" href="#JM"&gt;&lt;strong&gt;JM&lt;/strong&gt;&lt;/button&gt;
&lt;div id="JM" class="modal"&gt;
  &lt;div class="modal-content"&gt;
  &lt;span class="close"&gt;&amp;times;&lt;/span&gt;
  &lt;ul&gt;
    &lt;li&gt; One continuous longitudinal outcome&lt;/li&gt;
    &lt;li&gt; Competing risks&lt;/li&gt;
    &lt;li&gt; (pseudo) adaptive Gaussian quadrature&lt;/li&gt;
  &lt;/ul&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;button class="modal-button" href="#joineRML"&gt;&lt;strong&gt;joineRML&lt;/strong&gt;&lt;/button&gt;
&lt;div id="joineRML" class="modal"&gt;
  &lt;div class="modal-content"&gt;
  &lt;span class="close"&gt;&amp;times;&lt;/span&gt;
  &lt;ul&gt;
    &lt;li&gt; Multiple continuous longitudinal outcomes&lt;/li&gt;
    &lt;li&gt; Monte Carlo EM (&lt;font color="red"&gt;needs tuning&lt;/font&gt;)&lt;/li&gt;
  &lt;/ul&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;button class="modal-button" href="#frailtyPack"&gt;&lt;strong&gt;frailtyPack&lt;/strong&gt;&lt;/button&gt;
&lt;div id="frailtyPack" class="modal"&gt;
  &lt;div class="modal-content"&gt;
  &lt;span class="close"&gt;&amp;times;&lt;/span&gt;
  &lt;ul&gt;
    &lt;li&gt; One continuous longitudinal outcome&lt;/li&gt;
    &lt;li&gt; recurrent events &amp; terminating event&lt;/li&gt;
  &lt;/ul&gt;
  &lt;/div&gt;
&lt;/div&gt;
]

.pull-right[
**Bayesian:**
&lt;button class="modal-button" href="#JMbayes"&gt;&lt;strong&gt;JMbayes&lt;/strong&gt;&lt;/button&gt;
&lt;div id="JMbayes" class="modal"&gt;
  &lt;div class="modal-content"&gt;
  &lt;span class="close"&gt;&amp;times;&lt;/span&gt;
  &lt;ul&gt;
    &lt;li&gt; Multiple longitudinal outcomes of different type&lt;/li&gt;
    &lt;li&gt; competing risks &amp; multi-state models&lt;/li&gt;
    &lt;li&gt; Corrected two-stage approach (&lt;font color="red"&gt;not fully Bayesian&lt;/font&gt;)&lt;/li&gt;
  &lt;/ul&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;button class="modal-button" href="#stan_jm"&gt;&lt;strong&gt;stan_jm&lt;/strong&gt;&lt;/button&gt;
&lt;div id="stan_jm" class="modal"&gt;
  &lt;div class="modal-content"&gt;
  &lt;span class="close"&gt;&amp;times;&lt;/span&gt;
  &lt;ul&gt;
    &lt;li&gt; Multiple longitudinal outcomes of different type&lt;/li&gt;
    &lt;li&gt; competing risks &amp; multi-state models&lt;/li&gt;
    &lt;li&gt; fully Bayesian in STAN (&lt;font color="red"&gt;slow&lt;/font&gt;)&lt;/li&gt;
  &lt;/ul&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;button class="modal-button" href="#bamlss"&gt;&lt;strong&gt;jm_bamlss&lt;/strong&gt;&lt;/button&gt;
&lt;div id="bamlss" class="modal"&gt;
  &lt;div class="modal-content"&gt;
  &lt;span class="close"&gt;&amp;times;&lt;/span&gt;
  &lt;ul&gt;
    &lt;li&gt; single longitudinal outcomes&lt;/li&gt;
    &lt;li&gt; no competing risks nor multi-state models&lt;/li&gt;
  &lt;/ul&gt;
  &lt;/div&gt;
&lt;/div&gt;
]

---

## Available Software

&lt;br&gt;&lt;br&gt;

&lt;div style = "width: 75%; padding: 1.15em 2em; background-color: var(--nord0); margin: auto; display: block;"&gt;
&lt;strong&gt;Still no software package exists to satisfy all needs&lt;/strong&gt;
&lt;/div&gt;

---
class: center, middle, animated, fadeIn

# JMbayes2

---

## A New Package

.nord0box[
**&lt;span style="font-size: 1.5rem;"&gt;&amp;#8680;&lt;/span&gt; 
Learning from the lessons of the past we decided to create a new package**
]

--

&lt;br&gt;

Our aims

.pull-left[
* versatile
* user-friendly
* fast
* complete
]

.pull-right[
&lt;div style = "color: var(--nord3);"&gt;
&lt;ul&gt;
&lt;li&gt;cover (almost) all extensions&lt;/li&gt;
&lt;li&gt;straightforward syntax&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;C++&lt;/strong&gt; &amp; computational tricks&lt;/li&gt;
&lt;li&gt;support functions&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
]

---

## Under the Hood

.nord0box[
**Work horse: Metropolis-Hastings algorithm** &lt;br&gt;
&amp;nbsp;&amp;nbsp;&lt;span style="font-size: 1.5rem;"&gt;&amp;#8680;&lt;/span&gt; adaptive optimal scaling using the Robbinsâ€“Monro process
]

--

&lt;br&gt;

.nord0box[
**Computational aspects** &lt;br&gt;
&amp;nbsp;&amp;nbsp;&lt;span style="font-size: 1.5rem;"&gt;&amp;#8680;&lt;/span&gt; parallel sampling of random effects&lt;br&gt;
&amp;nbsp;&amp;nbsp;&lt;span style="font-size: 1.5rem;"&gt;&amp;#8680;&lt;/span&gt; info from separate fits&lt;br&gt;
]

---

## Under the Hood

&lt;br&gt;

.nord0box[
**Implementation** &lt;br&gt;
&amp;nbsp;&amp;nbsp;&lt;span style="font-size: 1.5rem;"&gt;&amp;#8680;&lt;/span&gt; MCMC written in C++&lt;br&gt;
&amp;nbsp;&amp;nbsp;&lt;span style="font-size: 1.5rem;"&gt;&amp;#8680;&lt;/span&gt; avoiding double computations&lt;br&gt;
]



---

## An Example


```r
library("JMbayes2")
fm1 &lt;- lme(log(serBilir) ~ year * sex, data = pbc2, random = ~ year | id)
CoxFit &lt;- coxph(Surv(years, status2) ~ sex, data = pbc2.id)

jointFit1 &lt;- jm(CoxFit, fm1, time_var = "year")
```

--

&lt;br&gt;

**Check convergence**


```r
ggtraceplot(jointFit1, "alphas")
```


---

## Traceplot

&lt;img src="CISNET_files/figure-html/unnamed-chunk-3-1.png" width="100%" /&gt;

---

## Model Summary

.scroll450[

```r
summary(jointFit1)
```

```
## 
## Call:
## jm(Surv_object = CoxFit, Mixed_objects = fm1, time_var = "year")
## 
## Data Descriptives:
## Number of Groups: 312		Number of events: 140 (44.9%)
## Number of Observations:
##   log(serBilir): 1945
## 
##                  DIC     WAIC      LPML
## marginal    4659.890 10413.08 -5605.518
## conditional 4983.646 12142.57 -6619.224
## 
## Random-effects covariance matrix:
##                     
##        StdDev   Corr
## (Intr) 1.0138 (Intr)
## year   0.1791 0.3515
## 
## Survival Outcome:
##                         Mean  StDev    2.5%  97.5%      P   Rhat
## sexfemale            -0.1651 0.4206 -0.9598 0.6748 0.6756 1.0052
## value(log(serBilir))  1.2052 0.1199  0.9608 1.4400 0.0000 1.0522
## 
## Longitudinal Outcome: log(serBilir) (family = gaussian, link = identity)
##                   Mean  StDev    2.5%  97.5%      P   Rhat
## (Intercept)     0.7284 0.3117  0.1390 1.3451 0.0136 1.0010
## year            0.2599 0.1007  0.0599 0.4587 0.0164 1.0022
## sexfemale      -0.2639 0.3258 -0.9100 0.3545 0.4191 1.0008
## year:sexfemale -0.0895 0.1046 -0.2942 0.1184 0.3704 1.0033
## sigma           0.4038 0.0224  0.3679 0.4534 0.0000 1.0264
## 
## MCMC summary:
## chains: 3 
## iterations per chain: 3500 
## burn-in per chain: 500 
## thinning: 1 
## time: 14 sec
```
]

---

## Multivariate

&lt;br&gt;


```r
fm2 &lt;- lme(prothrombin ~ year * sex, data = pbc2, random = ~ year | id)
fm3 &lt;- mixed_model(ascites ~ year + sex, data = pbc2,
                   random = ~ year | id, family = binomial())

jointFit2 &lt;- jm(CoxFit, list(fm1, fm2, fm3), time_var = "year",
                n_iter = 12000L, n_burnin = 2000L, n_thin = 5L)
```

---

## Multivariate

.scroll450[

```r
summary(jointFit2)
```

```
## 
## Call:
## jm(Surv_object = CoxFit, Mixed_objects = list(fm1, fm2, fm3), 
##     time_var = "year", n_iter = 12000L, n_burnin = 2000L, n_thin = 5L)
## 
## Data Descriptives:
## Number of Groups: 312		Number of events: 140 (44.9%)
## Number of Observations:
##   log(serBilir): 1945
##   prothrombin: 1945
##   ascites: 1885
## 
##                  DIC     WAIC       LPML
## marginal    11964.78 16930.52  -9635.204
## conditional 14723.31 18612.32 -10949.269
## 
## Random-effects covariance matrix:
##                                                  
##        StdDev   Corr                             
## (Intr) 0.9954 (Intr)   year (Intr)   year (Intr) 
## year   0.1871 0.3997                             
## (Intr) 0.8109 0.5355 0.4576                      
## year   0.3275 0.3985 0.3494 0.0229               
## (Intr) 3.7739 0.5237 0.4915 0.5420 0.2721        
## year   0.6237 0.3948 0.6136 0.2654 0.4105 -0.0380
## 
## Survival Outcome:
##                         Mean  StDev    2.5%  97.5%      P   Rhat
## sexfemale            -0.7290 0.5794 -1.9208 0.3517 0.1907 1.0046
## value(log(serBilir))  0.6076 0.2235  0.1509 1.0071 0.0207 1.0445
## value(prothrombin)    0.0849 0.1218 -0.1714 0.3088 0.4470 1.0277
## value(ascites)        0.4270 0.1302  0.2173 0.7187 0.0000 1.0377
## 
## Longitudinal Outcome: log(serBilir) (family = gaussian, link = identity)
##                   Mean  StDev    2.5%  97.5%      P   Rhat
## (Intercept)     0.6993 0.2872  0.1354 1.2762 0.0133 1.0000
## year            0.2633 0.0795  0.1054 0.4235 0.0017 1.0021
## sexfemale      -0.2353 0.3002 -0.8307 0.3527 0.4187 0.9999
## year:sexfemale -0.0762 0.0813 -0.2393 0.0813 0.3477 1.0023
## sigma           0.3927 0.0189  0.3632 0.4372 0.0000 1.0054
## 
## Longitudinal Outcome: prothrombin (family = gaussian, link = identity)
##                   Mean  StDev    2.5%   97.5%      P   Rhat
## (Intercept)    10.9401 0.4774  9.9973 11.8851 0.0000 1.0004
## year            0.2425 0.1636 -0.0760  0.5675 0.1357 1.0007
## sexfemale      -0.3958 0.5025 -1.4018  0.6271 0.4160 1.0004
## year:sexfemale  0.0534 0.1717 -0.2955  0.3952 0.7430 1.0014
## sigma           1.0857 0.0275  1.0379  1.1468 0.0000 1.0023
## 
## Longitudinal Outcome: ascites (family = binomial, link = logit)
##                Mean  StDev    2.5%   97.5%      P   Rhat
## (Intercept) -5.5191 1.3588 -8.3219 -3.0544 0.0000 1.0331
## year         0.7460 0.2060  0.3663  1.1732 0.0000 1.0671
## sexfemale   -0.4437 1.1785 -2.7529  1.9187 0.7137 1.0016
## 
## MCMC summary:
## chains: 3 
## iterations per chain: 12000 
## burn-in per chain: 2000 
## thinning: 5 
## time: 1.6 min
```
]

---

## Functional Forms


```r
jointFit3 &lt;- update(jointFit2, 
  functional_forms = ~ slope(log(serBilir)) + slope(log(serBilir)):sex + 
    area(prothrombin))
```

--

.pull-left[
**Slope**
`$$h_i(t) = h_0(t) \exp\biggl\{\alpha \bbox[#2E3440, 5pt]{\frac{d\color{var(--nord14)}{\eta(t)}}{dt}}\biggr\}$$`
]

.pull-right[
**(normalized) Area**
`$$h_i(t) = h_0(t) \exp\biggl\{\alpha \bbox[#2E3440, 5pt]{\frac{1}{t} \int_0^t \color{var(--nord14)}{\eta(s)}\; ds}\biggr\}$$`
]

&lt;div align="center" style="padding-top:30px;"&gt;\(\color{var(--nord3)}{\eta(t) = \mathbf x_i(t)^\top \boldsymbol \beta + \mathbf z_i(t)^\top \mathbf b_i}\)&lt;/div&gt;

---

## Functional Forms

.scroll450[

```r
summary(jointFit3)
```

```
## 
## Call:
## jm(Surv_object = CoxFit, Mixed_objects = list(fm1, fm2, fm3), 
##     time_var = "year", functional_forms = ~slope(log(serBilir)) + 
##         slope(log(serBilir)):sex + area(prothrombin), n_iter = 12000L, ...
## 
## Data Descriptives:
## Number of Groups: 312		Number of events: 140 (44.9%)
## Number of Observations:
##   log(serBilir): 1945
##   prothrombin: 1945
##   ascites: 1885
## 
##                  DIC     WAIC       LPML
## marginal    11957.01 15321.52  -8267.434
## conditional 14704.39 18370.03 -11060.401
## 
## Random-effects covariance matrix:
##                                                  
##        StdDev   Corr                             
## (Intr) 0.9833 (Intr)   year (Intr)   year (Intr) 
## year   0.1899 0.4513                             
## (Intr) 0.8147 0.5353 0.4752                      
## year   0.3326 0.4190 0.3521 0.0182               
## (Intr) 3.7273 0.5326 0.4975 0.5244 0.2839        
## year   0.6617 0.4681 0.6391 0.3142 0.3946 -0.0008
## 
## Survival Outcome:
##                                   Mean  StDev    2.5%  97.5%      P   Rhat
## sexfemale                      -1.0864 0.7650 -2.5264 0.4697 0.1677 1.0055
## slope(log(serBilir))            1.7330 1.4791 -1.2037 4.6108 0.2323 1.0356
## slope(log(serBilir)):sexfemale  1.0496 1.4661 -1.8813 3.8568 0.4630 1.0199
## area(prothrombin)               0.2768 0.2384 -0.2716 0.6968 0.2330 1.0072
## value(ascites)                  0.5304 0.1372  0.3139 0.8656 0.0000 1.0454
## 
## Longitudinal Outcome: log(serBilir) (family = gaussian, link = identity)
##                   Mean  StDev    2.5%  97.5%      P   Rhat
## (Intercept)     0.6892 0.2780  0.1409 1.2278 0.0163 1.0000
## year            0.2637 0.0755  0.1169 0.4145 0.0010 1.0005
## sexfemale      -0.2270 0.2906 -0.7866 0.3474 0.4320 0.9998
## year:sexfemale -0.0697 0.0782 -0.2256 0.0818 0.3697 0.9999
## sigma           0.3920 0.0181  0.3629 0.4333 0.0000 1.0037
## 
## Longitudinal Outcome: prothrombin (family = gaussian, link = identity)
##                   Mean  StDev    2.5%   97.5%      P   Rhat
## (Intercept)    10.9298 0.4952  9.9501 11.8928 0.0000 1.0016
## year            0.2457 0.1662 -0.0771  0.5765 0.1370 1.0013
## sexfemale      -0.3828 0.5239 -1.4007  0.6695 0.4543 1.0007
## year:sexfemale  0.0535 0.1757 -0.2919  0.3964 0.7603 1.0006
## sigma           1.0854 0.0276  1.0378  1.1464 0.0000 1.0005
## 
## Longitudinal Outcome: ascites (family = binomial, link = logit)
##                Mean  StDev    2.5%   97.5%     P   Rhat
## (Intercept) -5.5142 1.3394 -8.2056 -3.0562 0.000 1.0177
## year         0.7844 0.2029  0.4126  1.2093 0.000 1.0242
## sexfemale   -0.4306 1.1790 -2.7490  1.8488 0.712 1.0014
## 
## MCMC summary:
## chains: 3 
## iterations per chain: 12000 
## burn-in per chain: 2000 
## thinning: 5 
## time: 1.6 min
```
]

---

## Competing Risks

Bring the data in the competing risks long format


```r
pbc2.idCR &lt;- crLong(pbc2.id, statusVar = "status", censLevel = "alive", 
                    nameStrata = "CR")

pbc2.idCR[pbc2.idCR$id %in% c(1, 2, 5), c("id", "years", "status", "status2", "CR")]
```

```
##     id     years       status status2           CR
## 1    1  1.095170         dead       1         dead
## 1.1  1  1.095170         dead       0 transplanted
## 2    2 14.152338        alive       0         dead
## 2.1  2 14.152338        alive       0 transplanted
## 5    5  4.120578 transplanted       0         dead
## 5.1  5  4.120578 transplanted       1 transplanted
```

---

## Competing Risks

&lt;br&gt;

Fit a competing risks Cox model


```r
CoxFit_CR &lt;- coxph(Surv(years, status2) ~ (age + drug) * strata(CR),
                     data = pbc2.idCR)
```

---

## Competing Risks

&lt;br&gt;

Fit the competing risks joint model


```r
jFit_CR &lt;- jm(CoxFit_CR, fm1, time_var = "year", 
              functional_forms = ~ value(log(serBilir)):CR, 
              n_iter = 25000L, n_burnin = 5000L, n_thin = 5L)
```

---

## Competing Risks

.scroll450[

```r
summary(jFit_CR)
```

```
## 
## Call:
## jm(Surv_object = CoxFit_CR, Mixed_objects = fm1, time_var = "year", 
##     functional_forms = ~value(log(serBilir)):CR, n_iter = 25000L, 
##     n_burnin = 5000L, n_thin = 5L)
## 
## Data Descriptives:
## Number of Groups: 312		Number of events: 169 (27.1%)
## Number of Observations:
##   log(serBilir): 1945
## 
##                  DIC     WAIC      LPML
## marginal    4935.062 11225.76 -5554.083
## conditional 5221.027 12550.61 -8310.025
## 
## Random-effects covariance matrix:
##                     
##        StdDev   Corr
## (Intr) 1.0082 (Intr)
## year   0.1809 0.3661
## 
## Survival Outcome:
##                                        Mean  StDev    2.5%   97.5%      P
## age                                 -0.0944 0.0328 -0.1619 -0.0337 0.0020
## drugD-penicil                       -0.1947 0.4243 -1.0395  0.6194 0.6388
## age:strata(CR)dead                   0.1626 0.0330  0.1020  0.2306 0.0000
## drugD-penicil:strata(CR)dead         0.2051 0.4637 -0.7191  1.1138 0.6430
## value(log(serBilir)):CRtransplanted  0.9151 0.2020  0.5231  1.3291 0.0000
## value(log(serBilir)):CRdead          1.2572 0.1281  1.0121  1.5268 0.0000
##                                       Rhat
## age                                 1.1540
## drugD-penicil                       1.0312
## age:strata(CR)dead                  1.1951
## drugD-penicil:strata(CR)dead        1.0283
## value(log(serBilir)):CRtransplanted 1.0134
## value(log(serBilir)):CRdead         1.0013
## 
## Longitudinal Outcome: log(serBilir) (family = gaussian, link = identity)
##                   Mean  StDev    2.5%  97.5%      P   Rhat
## (Intercept)     0.7269 0.3192  0.0926 1.3522 0.0265 1.0002
## year            0.2682 0.1045  0.0617 0.4771 0.0132 1.0000
## sexfemale      -0.2659 0.3332 -0.9154 0.3975 0.4228 1.0001
## year:sexfemale -0.0946 0.1082 -0.3087 0.1210 0.3693 1.0002
## sigma           0.4062 0.0236  0.3697 0.4623 0.0000 1.0004
## 
## MCMC summary:
## chains: 3 
## iterations per chain: 25000 
## burn-in per chain: 5000 
## thinning: 5 
## time: 4.8 min
```
]

---

## More Features

.three-cols[

&lt;button class="modal-button" href="#GLMMs"&gt;&lt;strong&gt;Non-Gaussian Mixed Models&lt;/strong&gt;&lt;/button&gt;
&lt;div id="GLMMs" class="modal"&gt;
  &lt;div class="modal-content"&gt;
  &lt;span class="close"&gt;&amp;times;&lt;/span&gt;
  &lt;ul&gt;
    &lt;li&gt;Student's-t (&lt;code&gt;mixed_model(..., &lt;span class="hljs-string"&gt;family = students.t(df = 4)&lt;/span&gt;)&lt;/code&gt;)&lt;/li&gt;
    &lt;li&gt;Beta (&lt;code&gt;mixed_model(..., &lt;span class="hljs-string"&gt;family = beta.fam()&lt;/span&gt;)&lt;/code&gt;)&lt;/li&gt;
    &lt;li&gt;Gamma (&lt;code&gt;mixed_model(..., &lt;span class="hljs-string"&gt;family = Gamma()&lt;/span&gt;)&lt;/code&gt;)&lt;/li&gt;
    &lt;li&gt;censored Gaussian (&lt;code&gt;mixed_model(..., &lt;span class="hljs-string"&gt;family = censored.normal()&lt;/span&gt;)&lt;/code&gt;)&lt;/li&gt;
  &lt;/ul&gt;
  &lt;br&gt;
  &lt;ul&gt;
    &lt;li&gt;Binomial (&lt;code&gt;mixed_model(..., &lt;span class="hljs-string"&gt;family = binomial()&lt;/span&gt;)&lt;/code&gt;)&lt;/li&gt;
    &lt;li&gt;Poisson (&lt;code&gt;mixed_model(..., &lt;span class="hljs-string"&gt;family = poisson()&lt;/span&gt;)&lt;/code&gt;)&lt;/li&gt;
    &lt;li&gt;Negative Binomial (&lt;code&gt;mixed_model(..., &lt;span class="hljs-string"&gt;family = negative.binomial()&lt;/span&gt;)&lt;/code&gt;)&lt;/li&gt;
    &lt;li&gt;Beta Binomial (&lt;code&gt;mixed_model(..., &lt;span class="hljs-string"&gt;family = beta.binomial()&lt;/span&gt;)&lt;/code&gt;)&lt;/li&gt;
  &lt;/ul&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;button class="modal-button" href="#Plots"&gt;&lt;strong&gt;Diagnostics&lt;/strong&gt;&lt;/button&gt;
&lt;div id="Plots" class="modal"&gt;
  &lt;div class="modal-content"&gt;
  &lt;span class="close"&gt;&amp;times;&lt;/span&gt;
  &lt;ul&gt;
    &lt;li&gt;MCMC chains (&lt;code&gt;traceplot()&lt;/code&gt; or &lt;code&gt;ggtraceplot()&lt;/code&gt;)&lt;/li&gt;
    &lt;li&gt;Density (&lt;code&gt;traceplot()&lt;/code&gt; or &lt;code&gt;ggtraceplot()&lt;/code&gt;)&lt;/li&gt;
    &lt;li&gt;Gelman-Rubin (&lt;code&gt;gelman_diag()&lt;/code&gt;)&lt;/li&gt;
    &lt;li&gt;cumulative plot (&lt;code&gt;cumuplot()&lt;/code&gt;)&lt;/li&gt;
  &lt;/ul&gt;
  &lt;/div&gt;
&lt;/div&gt;

]

.three-cols[

&lt;button class="modal-button" href="#Penalties"&gt;&lt;strong&gt;Shrinkage Priors&lt;/strong&gt;&lt;/button&gt;
&lt;div id="Penalties" class="modal"&gt;
  &lt;div class="modal-content"&gt;
  &lt;span class="close"&gt;&amp;times;&lt;/span&gt;
      Using the &lt;strong&gt;priors&lt;/strong&gt; argument we can specify penalties:
  &lt;pre&gt;&lt;code class="r hljs remark-code"&gt;
  &lt;div class="remark-code-line"&gt;jm(..., &lt;span class="hljs-number"&gt;priors = list("penalty_alphas" = "horseshoe")&lt;/span&gt;)&lt;/div&gt;
  &lt;div class="remark-code-line"&gt;&lt;/div&gt;
  &lt;div class="remark-code-line"&gt;jm(..., &lt;span class="hljs-number"&gt;priors = list("penalty_gammas" = "ridge")&lt;/span&gt;)&lt;/div&gt;
&lt;/code&gt;&lt;/pre&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;button class="modal-button" href="#Compare"&gt;&lt;strong&gt;Model Comparison&lt;/strong&gt;&lt;/button&gt;
&lt;div id="Compare" class="modal"&gt;
  &lt;div class="modal-content"&gt;
  &lt;span class="close"&gt;&amp;times;&lt;/span&gt;
      Using the &lt;code&gt;compare_jm()&lt;/code&gt; function we can compare fitted joint models using DIC, WAIC and LPML
  &lt;pre&gt;&lt;code class="r hljs remark-code"&gt;
  &lt;div class="remark-code-line"&gt;&lt;span class="hljs-number"&gt;fit1&lt;/span&gt; &lt;- jm(&lt;span class="hljs-number"&gt;CoxModel1&lt;/span&gt;, &lt;span class="hljs-number"&gt;MixedModels1&lt;/span&gt;, ...)&lt;/div&gt;
  &lt;div class="remark-code-line"&gt;&lt;span class="hljs-string"&gt;fit2&lt;/span&gt; &lt;- jm(&lt;span class="hljs-string"&gt;CoxModel2&lt;/span&gt;, &lt;span class="hljs-string"&gt;MixedModels2&lt;/span&gt;, ...)&lt;/div&gt;
  &lt;div class="remark-code-line"&gt;&lt;/div&gt;
  &lt;div class="remark-code-line"&gt;compare_jm(&lt;span class="hljs-number"&gt;fit1&lt;/span&gt;, &lt;span class="hljs-string"&gt;fit2&lt;/span&gt;)&lt;/div&gt;
&lt;/code&gt;&lt;/pre&gt;
  &lt;/div&gt;
&lt;/div&gt;

]

.three-cols[
&lt;button class="modal-button" href="#DynPred"&gt;&lt;strong&gt;Dynamic Predictions&lt;/strong&gt;&lt;/button&gt;
&lt;div id="DynPred" class="modal"&gt;
  &lt;div class="modal-content"&gt;
  &lt;span class="close"&gt;&amp;times;&lt;/span&gt;
  &lt;strong&gt;To-Do&lt;/strong&gt;
  &lt;ul&gt;
    &lt;li&gt;Longitudinal outcomes&lt;/li&gt;
    &lt;li&gt;Event outcomes (including competing risks)&lt;/li&gt;
    &lt;li&gt;Accuracy measures&lt;/li&gt;
  &lt;/ul&gt;
  &lt;/div&gt;
&lt;/div&gt;

]

---
class: center, middle

.nord0box[
More about **JMbayes2** in the dedicated website&lt;br&gt;&lt;br&gt;
&lt;a href="https://drizopoulos.github.io/JMbayes2/"&gt;&lt;i class="fas fa-globe-americas"&gt;&lt;/i&gt; https://drizopoulos.github.io/JMbayes2/&lt;/a&gt;
]

---
class: the-end, center, middle
layout: true
count: false

## Thank you for your attention!


&lt;div id="contact"&gt;
&lt;a href="mailto:d.rizopoulos@erasmusmc.nl"&gt;&lt;i class="fas fa-envelope"&gt;&lt;/i&gt; d.rizopoulos@erasmusmc.nl&lt;/a&gt; &amp;emsp;
&lt;a href="https://twitter.com/drizopoulos"&gt;&lt;i class="fab fa-twitter"&gt;&lt;/i&gt; drizopoulos&lt;/a&gt; &amp;emsp;
&lt;a href="https://github.com/drizopoulos"&gt;&lt;i class="fab fa-github"&gt;&lt;/i&gt; drizopoulos&lt;/a&gt; &amp;emsp;
&lt;a href="http://www.drizopoulos.com/"&gt;&lt;i class="fas fa-globe-americas"&gt;&lt;/i&gt; http://www.drizopoulos.com/&lt;/a&gt;
&lt;/div&gt;

---
count: false

&lt;!-- &lt;script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'&gt;&lt;/script&gt; --&gt;
&lt;script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"&gt;
&lt;/script&gt;
 
 
&lt;script&gt;
// Get the button that opens the modal
var btn = document.querySelectorAll("button.modal-button");

// All page modals
var modals = document.querySelectorAll('.modal');

// Get the &lt;span&gt; element that closes the modal
var spans = document.getElementsByClassName("close");

// When the user clicks the button, open the modal
for (var i = 0; i &lt; btn.length; i++) {
 btn[i].onclick = function(e) {
    e.preventDefault();
    modal = document.querySelector(e.target.getAttribute("href"));
    modal.style.display = "block";
 }
}

// When the user clicks on &lt;span&gt; (x), close the modal
for (var i = 0; i &lt; spans.length; i++) {
 spans[i].onclick = function() {
    for (var index in modals) {
      if (typeof modals[index].style !== 'undefined') modals[index].style.display = "none";    
    }
 }
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
    if (event.target.classList.contains('modal')) {
     for (var index in modals) {
      if (typeof modals[index].style !== 'undefined') modals[index].style.display = "none";    
     }
    }
}
&lt;/script&gt;

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "nord",
"highlightLines": true,
"highlightSpans": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
